# CheckMultiLog
多种Windows日志分析、web日志分析，支持IIS日志、Apache日志、 Nginx 日志、 Tomcat日志 、Jetty日志、通用json（常见字段）安全分析。

## 一、支持的日志格式

### WEB日志
- IIS W3C
- NCSA（Apache / Nginx / Tomcat / Jetty）
- HAProxy
- AWS ALB/ELB
- 通用 JSON access log
- Unknown 未识别但包含 IP、时间、URI、User-Agent 信息的日志

### Windows日志
- Security日志
- 应用程序日志
- 系统日志
- SYSMON日志

Web日志分析演示
![食用实例](/demo.gif)

Windows日志分析演示
![食用实例](/demo2.gif)


> **说明**：免费版仅开放 **IIS W3C** 与 **NCSA(IIS)**；授权版解锁全部格式。

---

## 二、内置web日志分析规则种类
- **WebShell 检测**：冰蝎、哥斯拉、Neo-reGeorg 等
- **漏洞利用**：Shiro、Log4Shell、Spring4Shell、ThinkPHP、PHPUnit
- **弱口令/敏感接口**：K8s API/Docker API 未授权、IndexOf 目录列举
- **数据外带**：大 Base64 参数、Token/Session 泄露、归档批量下载
- **扫描识别**：xray、fscan、sqlmap、WPScan、Nuclei
- **通用攻击**：SQLi、XSS、路径遍历、恶意上传绕过、命令执行

> 规则来自 内置`AttackRules.ini`，采用正则表达式匹配 URL、Header、参数、请求体等，外置有ini文件可以自定义规则。


>  内置windows安全规则-安全威胁检测
- 内置23种安全检测规则，覆盖常见攻击场景
- 支持MITRE ATT&CK框架映射，方便安全分析
- 包括暴力破解检测、特权提升监控、持久化检测等核心安全功能
- 支持自定义规则目录加载额外检测规则

该工具内置了23种安全检测windowws 日志规则，覆盖多种攻击场景，主要包括：

| 规则ID | 规则名称 | 严重度 | MITRE ATT&CK |
|--------|----------|--------|--------------|
| R01 | 暴力破解后成功登录 | 高危 | TA0006, T1110 |
| R02 | 非工作时间RDP访问 | 中危 | TA0001, T1021.001 |
| R03 | 使用显式凭据 | 高危 | TA0006, T1550 |
| R04 | 特权登录 | 中危 | TA0004 |
| R05 | 在临时目录创建服务 | 高危 | TA0003, T1543.003 |
| R06 | 安全日志被清空 | 高危 | TA0005, T1070.001 |
| R07 | 审计策略被修改 | 高危 | TA0005, T1562.002 |
| R08 | 管理员组变更 | 高危 | TA0004, T1098 |
| R09 | 可疑服务安装 | 高危 | TA0003, T1543.003 |
| R10 | 向管理员共享写入 | 高危 | TA0005, TA0009 |
| R11 | RDP短时多目标成功登录 | 高危 | TA0001, T1021.001 |
| R12 | LSASS凭据转储 | 严重 | TA0006, T1003 |
| R13 | 注册表Run键指向临时目录 | 高危 | TA0003, T1547.001 |
| R14 | 新服务安装到临时用户路径 | 高危 | TA0003, T1543.003 |
| R15 | 日志被清空后可疑写入 | 高危 | TA0005, T1070.001 |
| R16 | 审计策略被修改 | 高危 | TA0005, T1562.002 |
| R17 | 高权组添加成员 | 严重 | TA0004, T1098 |
| R18 | 向ADMIN写入可执行 | 高危 | TA0005 |
| R19 | WMI远程执行 | 高危 | TA0002, T1047 |
| R20 | WinRM PowerShell远程会话 | 中危 | TA0002, T1021.006 |
| R21 | 可疑计划任务创建 | 高危 | TA0003, T1053.005 |
| R22 | regsvr32/rundll32/mshta远程加载 | 高危 | TA0002, T1218 |
| R23 | Defender策略被禁用 | 高危 | TA0005, T1562.001 |
---

## 三、报告输出优势
- 自动生成 **HTML 报告**，结构化展示攻击事件、Top IP、Top 规则
- 逐条高亮命中规则，保留原始日志行，便于取证与复盘
- 可折叠详情与清晰排版，适合审计输出与汇报
- 统计聚合：按 IP、规则、时间维度形成热点视图
- 可动态自定义搜索及排除事件、IP、规则等白名单优化


---

### 未来更新
- 支持 Windows、Linux 操作系统日志  
- 用户群反馈特定日志（WAF、其他类型 Web 日志、防火墙日志）

### 2025.9.18 - 更新
- 新增windows日志分析功能-授权通用 、支持三大日志+sysmon。windows分析报告建议“windows日志分析”选项卡点击查看打开


### 实现技术思路
- 1. 目标与边界 这个工具的目标是通过本机三类日志（应用程序、安全、系统）来识别入侵链路的关键阶段，包括初始执行、权限提升、凭据窃取、横向移动、持久化以及数据窃取与清痕。重点是围绕 MITRE ATT&CK 的战术阶段，从单机角度发现高置信度的攻击迹象。处理 Windows 日志能在本地快速落地并形成可回溯的证据链。
- 2.  数据采集与标准化 数据源主要是三类 evtx 文件：Security.evtx、System.evtx 和 Application.evtx， Sysmon。将四种日志格式 落地成统一的事件CEM模型，包含时间戳、日志类型、事件 ID、用户、进程、网络字段和原始内容。存储采用 SQLite 方便快速查询，同时写 Parquet 文件用于批量分析，建立索引在 ts、event_id、user、ip 等字段上。富化数据包括常见登录地白名单、内网段识别、Geo/ASN 数据以及进程哈希白名单。
- 3.  核心检测面 从网络攻防角度，三类日志可以覆盖一些高价值事件组合。认证与横向移动方面，可检测 4625 连败后出现 4624 成功，或 LogonType=3/10 的异常远程登录，配合 4648 显式凭据使用来识别横移。Kerberos 攻击迹象包括 4768/4769 的失败率激增或弱加密票据。执行与提权方面，工具关注 4672 特权登录，4697/7045 服务安装在异常目录，或 7036 服务频繁变更。凭据与审计干扰方面，1102 清日志、4719 审计策略更改、4720–4732 账户或组操作都属于关键信号。RDP/SMB 横移可通过 LogonType=10 的 RDP 登录结合 7045 服务安装或 5145 SMB 写入来检测。
- 4. 规则与关联引擎 规则用 YAML 格式描述，字段映射到统一事件模型，支持条件匹配、计数窗口和跨事件关联。可用滑动窗口计数器或时间轮来实现，结合 hashbrown 存储状态。举例来说，暴力破解后成功登录规则就是统计 5 分钟内同账户同 IP 出现超过 8 次 4625，然后跟随一个 4624 成功，触发高危告警。服务安装可疑路径规则就是检测 7045 事件中的二进制路径是否落在 Temp、Users 等非常驻目录。关联引擎要支持白名单抑制和冷却时间，避免重复告警。同时，可以结合基线数据（用户常用登录时段/IP）做异常检测，再与规则叠加提高置信度。 评估与降噪 先基线七天，统计正常登录时段与来源，再放开阈值。 对“夜间/非常用地”设置环境化白名单，减少一刀切。 日志分析重点覆盖：暴破→成功、RDP/SMB横移、服务安装异常路径、日志清理与审计更改、Kerberos异常、LSASS访问。要求代码可编译占位，字段名对齐CEM。
